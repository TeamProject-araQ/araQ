<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
    <div class="card" style="min-width:250px;">
        <div style="height:60vh; overflow-y:scroll;" id="chatBoard">
            <div class="card date" th:text="${#temporals.format(room.createDate, 'yyyy년 MM월 dd일')}"></div>
            <div class="chatBox" th:each="chat : ${chatList}"
                 th:classappend="(${chat.difDate} ? ' difDate' : '') + (${chat.writer.username.equals(user.username)} ? ' text-end' : '')"
                 th:data-date="${#temporals.format(chat.createDate, 'yyyy년 MM월 dd일')}">
                <img th:if="${!chat.writer.username.equals(user.username)}" th:src="@{${chat.writer.image}}" alt="">
                <div>
                    <a href="javascript:void(0)" th:text="${chat.writer.nickName}" class="chatWriterBtn"
                       th:if="${!chat.writer.username.equals(user.username)}"></a>
                    <div>
                        <small th:text="${#temporals.format(chat.createDate, 'HH:mm')}"
                               th:if="${chat.writer.username.equals(user.username)}"></small>
                        <div class="card" th:classappend="${chat.writer.username.equals(user.username)} ? 'ourColor'">
                            <span class="confirm"
                                  th:if="${chat.writer.username.equals(user.username) && chat.confirm == 0}"></span>
                            <div th:if="${chat.images != null}">
                                <a th:each="image : ${chat.images}" th:href="@{${image}}">
                                    <img th:src="@{${image}}" alt="" style="width:100px; height:100px;">
                                </a>
                            </div>
                            <p class="card-body text-start" th:text="${chat.content}"></p>
                        </div>
                        <small th:text="${#temporals.format(chat.createDate, 'HH:mm')}"
                               th:if="${!chat.writer.username.equals(user.username)}"></small>
                    </div>
                </div>
            </div>
        </div>
        <form id="sendChatForm" autocomplete="off">
            <div class="card" id="imagePreviewForm">
                <div class="card-body" id="imagePreview"></div>
            </div>
            <textarea type="text" id="msgContent" class="form-control"></textarea>
            <div class="d-flex justify-content-between align-items-center m-2">
                <a th:href="@{/chat/list}" class="btn btn-outline-secondary" style="padding:3px 5px;">나가기</a>
                <a href="javascript:void(0)" id="chatImageBtn">
                    <i class="bi bi-images" style="font-size: 30px;"></i>
                </a>
                <a href="javascript:void(0)" id="voiceChatBtn">
                    <i class="bi bi-telephone-fill" style="font-size: 30px;"></i>
                </a>
                <a href="javascript:void(0)" id="chatReportBtn">
                    <img th:src="@{/image/etc/siren.png}" alt="" style="height: 30px; width: 30px; margin-bottom: 10px;">
                </a>
                <button type="submit" style="border:0;">
                    <i class="bi bi-send-fill" style="font-size: 30px; color: rgb(146, 132, 168)"></i>
                </button>
            </div>
        </form>
        <input type="file" id="chatImageInput" accept="image/*" multiple>
        <audio autoplay></audio>
    </div>
    <script th:inline="javascript">
        var roomCode = [[${room.code}]];
        var nickName = [[${user.nickName}]];
        var user = [[${user.username}]];
        var target = [[${target.username}]];
        var targetNick = [[${target.nickName}]];
    </script>
</div>
<script type="text/javascript" th:src="@{/chat.js}" layout:fragment="script"></script>
</html>