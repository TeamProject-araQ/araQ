<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
    <div id="carouselExample" class="carousel slide">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <div class="card mb-3">
                    <div th:text="|총 ${#lists.size(userList)}명의 유저가 추천되었습니다.|" style="height:800px;"></div>
                </div>
            </div>
            <div class="carousel-item" th:each="user : ${userList}">
                <div class="card mb-3">
                    <div class="row g-0">
                        <div class="col-md-8">
                            <img th:if="${user.gender.equals('여성')}" src="/profile/default-w.jpg"
                                 class="img-fluid rounded-start" alt="...">
                            <img th:if="${user.gender.equals('남성')}" src="/profile/default-m.jpg"
                                 class="img-fluid rounded-start" alt="...">
                        </div>
                        <div class="col-md-4">
                            <div class="card-body">
                                <h1 class="card-title" th:text="${user.nickName}"></h1>
                                <p class="card-text" th:text="${user.age}"></p>
                                <a href="javascript:void(0)" class="btn btn-primary chatRequestBtn"
                                   th:data-value="${user.username}">채팅 신청</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
</div>
<script layout:fragment="script">
    $(function() {
        var csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
        var csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');


        $(".chatRequestBtn").on('click', function() {
            if (confirm("채팅 신청을 하시겠습니까?")) {
                var dataValue = $(this).data("value");

                $.ajax({
                    url: "/chat/request",
                    type: "POST",
                    headers: {
                        [csrfHeader]: csrfToken
                    },
                    contentType:"text/plain",
                    data: dataValue,
                    success: function() {
                        alert("성공적으로 요청이 완료되었습니다.");
                    },
                    error: function(err) {
                        alert("요청이 실패하였습니다.");
                    }
                });
            }
        });
    });
</script>
</html>