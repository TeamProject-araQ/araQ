<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
    <h4 class="highlight" style="text-align:center;" th:text="|${post.id}번째 톡|"></h4>
    <div class="my-3">
        <div style="border-top:2px solid #d8d3e0; border-bottom:2px solid #d8d3e0; padding:20px;">
            <h5 th:text="${post.content}" class="my-2"></h5>
            <div class="d-flex align-items-end">
                <img th:src="@{${post.writer.image}}" alt="" style="width:30px; height:30px; border-radius:10px;"
                     class="me-2">
                <div th:text="${post.writer.nickName}" style="font-weight:bold;"></div>
                <div style="font-size:10pt; font-family:'nanum-light'; color:gray;" class="ms-2"
                     th:text="${#temporals.format(post.createDate, 'yyyy-MM-dd HH:mm')}"></div>
            </div>
            <div class="d-flex justify-content-end">
                <a href="javascript:void(0)" class="btn btn-sm 버튼" id="copyBtn"><i class="bi bi-clipboard me-1"></i>url 복사</a>
                <a th:href="@{|/post/modify/${post.id}|}" class="btn btn-sm 버튼 mx-2"
                   th:if="${post.writer.username == user.username}"><i
                        class="bi bi-pencil-square me-1"></i>수정</a>
                <a href="javascript:void(0)" th:data-uri="@{|/post/delete/${post.id}|}" id="deleteP"
                   class="btn btn-sm 버튼" th:if="${post.writer.username == user.username}"><i
                        class="bi bi-trash3 me-1"></i>삭제</a>
            </div>
        </div>
        <h5 class="my-3" th:text="|댓글 [${#lists.size(post.commentList)}]|"></h5>
        <div>
            <form th:action="@{|/comment/create/${post.id}|}" method="post" class="input-group" id="regForm">
                <input type="text" id="content" name="content" class="form-control">
                <input type="button" value="등록" class="btn 버튼-full" id="regBtn">
            </form>
        </div>
        <div th:each="comment : ${post.commentList}" class="my-3 py-2" style="border-bottom:1px solid lightgray;">
            <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <img th:src="@{${comment.writer.image}}" alt="" style="width:25px;height:25px;border-radius:10px;"
                         class="me-2">
                    <div th:text="${comment.writer.nickName}" style="font-weight:bold;"></div>
                    <span class="mx-3">:</span>
                    <div th:text="${comment.content}"></div>
                </div>
                <div style="font-size:10pt; font-family:'nanum-light'; color:gray;"
                     th:text="${#temporals.format(comment.createDate, 'yyyy-MM-dd HH:mm')}"></div>
            </div>
            <div th:if="${comment.writer.username == user.username}" class="text-end" style="font-size:10pt;">
                <a type="button" data-bs-toggle="modal"
                   th:data-bs-target="|#comment_${comment.id}|">수정</a>
                <span class="mx-1">|</span>
                <a href="javascript:void(0)" class="deleteC"
                   th:data-uri="@{|/comment/delete/${comment.id}|}">삭제</a>
            </div>
            <!-- 댓글 수정 모달 -->
            <div class="modal fade" th:id="|comment_${comment.id}|" tabindex="-1" aria-labelledby="modifyCommentLabel"
                 aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="modifyCommentLabel">댓글 수정</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form th:action="@{|/comment/modify/${comment.id}|}" method="post" id="modifyForm">
                            <div class="modal-body">
                                <textarea name="content" id="modifyContent" cols="30" rows="7"
                                          class="form-control" th:text="${comment.content}"></textarea>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn 버튼-full" id="modifyBtn">수정</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script layout:fragment="script">
    $(function () {

        $('#copyBtn').click(function () {
            var urlToCopy = window.location.href;
            navigator.clipboard.writeText(urlToCopy).then(function () {
                alert('URL이 클립보드에 복사되었습니다.');
            }).catch(function (error) {
                alert('복사에 실패했습니다: ', error);
            });
        });

        $("#regBtn").on('click', function () {
            if ($("#content").val() == "")
                alert("댓글 내용을 입력해주세요.");
            else {
                alert("댓글이 등록되었습니다.");
                $("#regForm").submit();
            }
        });

        $("#deleteP").on('click', function () {
            if (confirm("이 톡을 삭제하시겠습니까?"))
                location.href = this.dataset.uri;
        });

        $("#modifyForm #modifyBtn").on('click', function () {
            if ($("#modifyContent").val() === "")
                alert("수정할 내용을 입력해주세요.");
            else {
                alert("댓글이 수정되었습니다.");
                $("#modifyForm").submit();
            }
        });

        $(".deleteC").on('click', function () {
            if (confirm("댓글을 삭제하시겠습니까?")) {
                location.href = this.dataset.uri;
            }
        });

    });

</script>
</html>