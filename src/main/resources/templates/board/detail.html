<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container">
    <div class="my-4">
        <div class="d-flex justify-content-between" style="border-bottom:1px solid black; padding-bottom:5px;">
            <div class="d-flex">
                <img th:src="@{${post.writer.image}}" alt="" style="width:30px;height:30px;border-radius:10px;">
                <div th:text="${post.writer.nickName}" style="font-weight:bold;"></div>
            </div>
            <div th:if="${post.writer.username == user.username}">
                <a th:href="@{|/post/modify/${post.id}|}">수정</a>
                <span>|</span>
                <a href="javascript:void(0)" th:data-uri="@{|/post/delete/${post.id}|}" id="deleteP">삭제</a>
            </div>
        </div>
        <div th:text="${post.content}" class="border border-dark p-2 my-2 text-center"></div>
        <div class="d-flex justify-content-end">
            <div th:text="${#temporals.format(post.createDate, 'yyyy-MM-dd HH:mm')}"></div>
        </div>
        <h5 class="border-bottom border-secondary pb-1">댓글</h5>
        <div>
            <form th:action="@{|/comment/create/${post.id}|}" method="post" class="input-group" id="regForm">
                <input type="text" id="content" name="content" class="form-control">
                <input type="button" value="등록" class="btn btn-outline-dark" id="regBtn">
            </form>
        </div>
        <div th:each="comment : ${post.commentList}">
            <div class="d-flex align-items-center">
                <img th:src="@{${comment.writer.image}}" alt="" style="width:25px;height:25px;border-radius:10px;">
                <div th:text="${comment.writer.nickName}" style="font-weight:bold;"></div>
            </div>
            <div th:text="${comment.content}"></div>
            <div th:text="${#temporals.format(comment.createDate, 'yyyy-MM-dd HH:mm')}"></div>
            <div th:if="${comment.writer.username == user.username}">
                <button type="button" class="btn btn-secondary" data-bs-toggle="modal"
                        th:data-bs-target="|#comment_${comment.id}|">수정
                </button>
                <a href="javascript:void(0)" class="deleteC btn btn-secondary"
                   th:data-uri="@{|/comment/delete/${comment.id}|}">삭제</a>
            </div>
            <!-- 댓글 수정 모달 -->
            <div class="modal fade" th:id="|comment_${comment.id}|" tabindex="-1" aria-labelledby="modifyCommentLabel"
                 aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="modifyCommentLabel">댓글 수정</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form th:action="@{|/comment/modify/${comment.id}|}" method="post" id="modifyForm">
                            <div class="modal-body">
                                <textarea name="content" id="modifyContent" cols="30" rows="10"
                                          class="form-control" th:text="${comment.content}"></textarea>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" id="modifyBtn">수정</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script layout:fragment="script">
    $(function () {
        $("#regBtn").on('click', function() {
            if ($("#content").val() == "")
                alert("댓글 내용을 입력해주세요.");
            else {
                alert("댓글이 등록되었습니다.");
                $("#regForm").submit();
            }
        });

        $("#deleteP").on('click', function() {
            if(confirm("이 톡을 삭제하시겠습니까?"))
                location.href = this.dataset.uri;
        });

        $("#modifyBtn").on('click', function() {
            if($("#modifyContent").val() == "")
                alert("수정할 내용을 입력해주세요.");
            else {
                alert("댓글이 수정되었습니다.");
                $("#modifyForm").submit();
            }
        });

        $(".deleteC").on('click', function() {
            if (confirm("댓글을 삭제하시겠습니까?")) {
                location.href = this.dataset.uri;
            }
        });

    });

</script>
</html>